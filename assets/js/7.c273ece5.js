(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{250:function(t,e,s){"use strict";s.r(e);var a=s(0),r=Object(a.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"服务器时区和java进程时区不一致问题解决"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务器时区和java进程时区不一致问题解决","aria-hidden":"true"}},[t._v("#")]),t._v(" "),s("center",[t._v(" 服务器时区和JAVA进程时区不一致问题解决")])],1),t._v(" "),t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._m(12),t._v(" "),s("p",[t._v("现在去date一下，看看结果，果然改成了UTC：")]),t._v(" "),t._m(13),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),s("p",[t._v("修改为：")]),t._v(" "),t._m(26),s("p",[t._v("重启MySQL服务")]),t._v(" "),t._m(27),s("p",[t._v("再次进入到MySQL命令行，检查当前时间")]),t._v(" "),t._m(28),s("p",[t._v("到这个为止，MySQL已经切换到UTC时区了。")]),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._m(32),t._v(" "),t._m(33),t._v(" "),t._m(34),t._v(" "),t._m(35),s("p",[t._v("接下来就可以进行重新部署切换了！！！！")]),t._v(" "),s("p",[t._v("建议将项目中所用的data类型转换成DateTime类型进行保存到数据库中去。")])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("em",[e("strong",[this._v("        本人在开发国际化项目时，遇到多项目多平台时区的问题，解决思路大概为将服务器操作系统，数据库，项目默认进程时区都统一为世界协调时区，即UTC(Universal Time/Temps Cordonné 世界标准时间)，然后各个平台获取服务器同一时区，展示时根据机子本地时区做转换，起到数据统一传递，多平台多时区统一展示的效果。"),e("br"),this._v("具体操作如下：")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"查看当然操作系统的时区"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看当然操作系统的时区","aria-hidden":"true"}},[this._v("#")]),this._v(" 查看当然操作系统的时区")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("命令如下：")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("[root@localhost ~]# date\nFri Jun 28 10:34:48 CST 2019\n\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"通过查询相关资料："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#通过查询相关资料：","aria-hidden":"true"}},[this._v("#")]),this._v(" 通过查询相关资料：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("p",[t._v("GMT(Greenwich Mean Time，格林威治标准时间): 是指位于英国伦敦郊区的皇家格林尼治天文台的标准时间，因为本初子午线被定义在通过那里的经线。")])]),t._v(" "),s("li",[s("p",[t._v("UTC(Universal Time/Temps Cordonné 世界标准时间)")])]),t._v(" "),s("li",[s("p",[t._v("CST可以为如下4个不同的时区的缩写：美国、澳大利亚、古巴或中国的标准时间")]),t._v(" "),s("ul",[s("li",[t._v("美国中部时间：Central Standard Time (USA) UT-6:00")]),t._v(" "),s("li",[t._v("澳大利亚中部时间：Central Standard Time (Australia) UT+9:30")]),t._v(" "),s("li",[t._v("中国标准时间：China Standard Time UT+8:00")]),t._v(" "),s("li",[t._v("古巴标准时间：Cuba Standard Time UT-4:00")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("em",[e("strong",[this._v("可先查看是否先开启UTC，方法就是在/etc/sysconfig/clock的文件里修改这样一处：UTC=true。这样即使机器重启，UTC时间依旧会“BIOS ▶ UTC时区转换 ▶ 系统时间”的顺序正常使用。(本人的操作系统中暂无该文件，所以我就直接滤过)")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"修改操作系统时区为utc"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改操作系统时区为utc","aria-hidden":"true"}},[this._v("#")]),this._v(" 修改操作系统时区为UTC")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"在centos-6-5里，各时区的时间是在一个叫-usr-share-zoneinfo-的文件夹下，在里面我们发现了我们的目标-utc，如图："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在centos-6-5里，各时区的时间是在一个叫-usr-share-zoneinfo-的文件夹下，在里面我们发现了我们的目标-utc，如图：","aria-hidden":"true"}},[this._v("#")]),this._v(" 在Centos 6.5里，各时区的时间是在一个叫/usr/share/zoneinfo/的文件夹下，在里面我们发现了我们的目标----UTC，如图：")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"https://s1.51cto.com/images/blog/201801/25/2b0fb7db39cb192317fb5451ce3847cf.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=",alt:"UTC"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("修改时区命令：")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("[root@localhost /]#     mv /etc/localtime /etc/localtime-bak\n[root@localhost /]#     ln -s /usr/share/zoneinfo/UTC /etc/localtime\n\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h5",{attrs:{id:"先把老的时间文件备份，然后把utc文件做一个软连接过来即可。我们所熟悉的date命令就是-etc-localtime的输出结果。"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#先把老的时间文件备份，然后把utc文件做一个软连接过来即可。我们所熟悉的date命令就是-etc-localtime的输出结果。","aria-hidden":"true"}},[this._v("#")]),this._v(" 先把老的时间文件备份，然后把UTC文件做一个软连接过来即可。我们所熟悉的date命令就是/etc/localtime的输出结果。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("[root@localhost zoneinfo]# date\nFri Jun 28 03:05:01 UTC 2019\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"设置mysql默认时区为utc"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置mysql默认时区为utc","aria-hidden":"true"}},[this._v("#")]),this._v(" 设置MySQL默认时区为UTC")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"查看当前mysql时区"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看当前mysql时区","aria-hidden":"true"}},[this._v("#")]),this._v(" 查看当前MySQL时区")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("命令如下:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v(' show variables like "%time_zone%";\n +------------------+--------+\n| Variable_name    | Value  |\n+------------------+--------+\n| system_time_zone | CST    |\n| time_zone        | +08:00 |\n+------------------+--------+\n2 rows in set (0.00 sec)\n\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"http://psx66r0l1.bkt.clouddn.com/mysql-time-zone.png",alt:"时区"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"当前会话修改时区"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#当前会话修改时区","aria-hidden":"true"}},[this._v("#")]),this._v(" 当前会话修改时区")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('mysql>SET time_zone = ‘+0:00’;\nmysql> show variables like "%time_zone%";\n+------------------+--------+\n| Variable_name    | Value  |\n+------------------+--------+\n| system_time_zone | CST    |\n| time_zone        | +00:00 |\n+------------------+--------+\n2 rows in set (0.00 sec)\n\n\nmysql> select now();\n+---------------------+\n| now()               |\n+---------------------+\n| 2019-06-28 03:28:27 |\n+---------------------+\n1 row in set (0.00 sec)\n\n\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("此修改只对当前会话有效，退出会话后，修改失效。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"配置文件my-cnf修改时区"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置文件my-cnf修改时区","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置文件my.cnf修改时区")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"永久解决方案"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#永久解决方案","aria-hidden":"true"}},[this._v("#")]),this._v(" 永久解决方案")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("命令：")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("[root@localhost zoneinfo]# vim /etc/my.cnf\n\n[mysqld]\nlower_case_table_names=1\n#skip-grant-tables\ndefault-time_zone='+08:00'\ndatadir=/data/mysql\nsocket=/var/lib/mysql/mysql.sock\n# Disabling symbolic-links is recommended to prevent assorted security risks\nsymbolic-links=0\n# Settings user and group are ignored when systemd is used.\n# If you need to run mysqld under a different user or group,\n# customize your systemd unit file for mariadb according to the\n# instructions in http://fedoraproject.org/wiki/Systemd\nbind-address=0.0.0.0\n#设置数据库编码方式\ncharacter-set-server=utf8\ninit_connect='SET NAMES utf8'\n\n[mysqld_safe]\nlog-error=/var/log/mariadb/mariadb.log\npid-file=/var/run/mariadb/mariadb.pid\n#关闭密码严格校验#\n#validate-password=off\n#\n# include all files from the config directory\n#\n!includedir /etc/my.cnf.d\n\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("default-time_zone='+0:00'\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("[root@localhost etc]# service mysqld restart\nRedirecting to /bin/systemctl restart mysqld.service\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("[root@localhost /]# mysql -uroot -p\nEnter password: \nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 19\nServer version: 5.7.25 MySQL Community Server (GPL)\n\nCopyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql> select now();\n+---------------------+\n| now()               |\n+---------------------+\n| 2019-06-28 03:55:02 |\n+---------------------+\n1 row in set (0.00 sec)\n\nmysql> \n\nmysql> show variables like \"%time_zone%\";\n+------------------+--------+\n| Variable_name    | Value  |\n+------------------+--------+\n| system_time_zone | UTC    |\n| time_zone        | +00:00 |\n+------------------+--------+\n2 rows in set (0.00 sec)\n\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"将springboot项目设置默认时区为utc（包含进程时区）"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#将springboot项目设置默认时区为utc（包含进程时区）","aria-hidden":"true"}},[this._v("#")]),this._v(" 将springboot项目设置默认时区为UTC（包含进程时区）")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"在springboot启动类中，添加默认时区的设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在springboot启动类中，添加默认时区的设置","aria-hidden":"true"}},[this._v("#")]),this._v(" 在springboot启动类中，添加默认时区的设置")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('@PostConstruct\n    void started() {\n        TimeZone.setDefault(TimeZone.getTimeZone("UTC"));\n    }\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("，完成代码如图所示：\n"),e("img",{attrs:{src:"http://psx66r0l1.bkt.clouddn.com/springboot-start.png",alt:"完整"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"在连接数据库地址中加入-servertimezone-utc-uselegacydatetimecode-false时区设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在连接数据库地址中加入-servertimezone-utc-uselegacydatetimecode-false时区设置","aria-hidden":"true"}},[this._v("#")]),this._v(" 在连接数据库地址中加入"),e("code",[this._v("&serverTimezone=UTC&useLegacyDatetimeCode=false")]),this._v("时区设置")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"在application-yml中加入如下配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在application-yml中加入如下配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 在application.yml中加入如下配置")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("spring:\n  jackson:\n    time-zone:UTC\n    date-format:yyyy-MM-dd HH:mm:ss\n")])])])}],!1,null,null,null);e.default=r.exports}}]);